---
title: "Static site occupancy model - Unmarked"
author: "Markus Fjellstad Israelsen"
date: "25 januar 2018"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Import detection/nondetection data and divide into year (to do single-season occupancy modelling on each year separately).
Import matrix of sites and their latitude + longitude coordinates.
Import line observations
Import masl, habitat and mean june temperatures for each site
```{r}
library(readr)
yfjellrype <- read_delim("C:/Users/marku/Desktop/Master/Dataset/mydata.csv", ";", escape_double = FALSE, trim_ws = TRUE)
View(yfjellrype)

# Split yfjellrype into each year
y2011 = yfjellrype[ , 1:20]
y2012 = yfjellrype[, 21:40]
y2013 = yfjellrype[, 41:60]
y2014 = yfjellrype[, 61:80]
y2015 = yfjellrype[, 81:100]
y2016 = yfjellrype[, 101:120]

library(readr)
First_fjellrype_lat_long = read_csv("C:/Users/marku/Desktop/Master/Dataset/First fjellrype lat long.csv")
View(First_fjellrype_lat_long)

library(readr)
Line_observations <- read_csv("C:/Users/marku/Desktop/Master/Dataset/Line observations.csv")
View(Line_observations)

library(readr)
Covariater_Midpunkt_UTMSone33 <- read_delim("C:/Users/marku/Desktop/Master/Dataset/Covariater_Midpunkt_UTMSone33.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)
View(Covariater_Midpunkt_UTMSone33)
Covariater_Midpunkt_UTMSone33 = Covariater_Midpunkt_UTMSone33[- c(494), ]
```


Load unmarked package
```{r}
library(unmarked)
```


Start with creating a vector containing the sites that are known to be occupied (for the "knownOcc" argument in the single-season model). First, the variable sitenum is created to identify which rownumber corresponds to which sitenumber (for instance, row [45] --> sitenumber 432)
```{r}
sitenum = c()
sitenum = as.matrix(First_fjellrype_lat_long$RUTENR, ncol = 1)
sitenum = matrix(sitenum, ncol = 1, dimnames = list(c(), c("site")))
head(sitenum)

```


Identifying the rows for the known occupancy of the 2011 detection/nondetection data
```{r}
lineobs = data.frame(Line_observations)
lineobs$Art = NULL
line2011 = c()

# for loop that appends the rows from the line observations with the year 2011 to the variable line2011
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2011) {
    line2011 = append(line2011, lineobs[row, 1])
  }
}
line2011 = matrix(line2011, ncol = 1)
line2011 = cbind(line2011, rep(2011, length(line2011)))
line2011 = cbind(line2011, rep(1, length(line2011[,1]))) # Adding 1 to all the entries of line 2011
line2011 = matrix(line2011, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2011 = data.frame(line2011)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2011 = line2011$sitenumber
count = 0
row2011 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2011)){
    row2011 = append(row2011, count) # row2011 is the variable with the rownumber for each site known to be occupied
  }
}

```


Create variables for the unstandardized, original covariates 
```{r}
sitenr = Covariater_Midpunkt_UTMSone33$RuteNr
masl.orig = Covariater_Midpunkt_UTMSone33$HøydeOverHavet
habitat.orig = Covariater_Midpunkt_UTMSone33$Norut_Habitat1_2
precip.year.orig = Covariater_Midpunkt_UTMSone33$Årsnedbør
avg.temp.june.orig = Covariater_Midpunkt_UTMSone33$Juni_Middeltemp
latitude.orig = First_fjellrype_lat_long$Latitude
longitude.orig = First_fjellrype_lat_long$Longitude

```


Overview of covariates
```{r}
covs = cbind(masl.orig, precip.year.orig, avg.temp.june.orig, latitude.orig, longitude.orig)
par(mfrow = c(3,3))
for(i in 1:5){
hist(covs[,i], breaks = 50, col = "grey", main = colnames(covs)[i])
}
pairs(cbind(masl.orig, precip.year.orig, avg.temp.june.orig, latitude.orig, longitude.orig))
```


Standardize the original covariates (Standardizing to get the variables on the same scale?)
```{r}
mean.masl = mean(masl.orig, na.rm = TRUE)
mean.precip.year.orig = mean(precip.year.orig, na.rm = TRUE)
mean.avg.temp.june.orig = mean(avg.temp.june.orig, na.rm = TRUE)
mean.latitude.orig = mean(latitude.orig, na.rm= TRUE) # Is it ok to standardize latitude and longitude? 
mean.longitude.orig = mean(longitude.orig, na.rm = TRUE) 

sd.masl = sd(masl.orig, na.rm = TRUE)
sd.precip.year.orig = sd(precip.year.orig, na.rm = TRUE)
sd.avg.temp.june.orig = sd(avg.temp.june.orig, na.rm = TRUE)
sd.latitude.orig = sd(latitude.orig, na.rm = TRUE)
sd.longitude.orig = sd(longitude.orig, na.rm = TRUE)

masl = (masl.orig - mean.masl) / sd.masl
precip.year = (precip.year.orig - mean.precip.year.orig) / sd.precip.year.orig
avg.temp.june = (avg.temp.june.orig - mean.avg.temp.june.orig) / sd.avg.temp.june.orig
latitude = (latitude.orig - mean.latitude.orig) / sd.latitude.orig
longitude = (longitude.orig - mean.longitude.orig) / sd.longitude.orig

```


Add detection/nondetection data and covariates together in a matrix, which makes it possible to remove the rows where there are missing covariate information. 
Overwrite the covariate variables based on the new dataset.
```{r}
y2011.cov = cbind(y2011, masl, precip.year, avg.temp.june, latitude, longitude, habitat.orig)
View(y2011.cov)

y2011.cov = y2011.cov[complete.cases(y2011.cov[ , 21:25]),] # Removing rows where either of the covariates have NAs (including the y values)

y2011.cov = y2011.cov[- c(480),] # Manually removed last row because the habitat.orig had a NA value in the last row that was not caught by the complete.cases function

masl.2011 = y2011.cov$masl
precip.2011 = y2011.cov$precip.year
avg.temp.june.2011 = y2011.cov$avg.temp.june
latitude.2011 = y2011.cov$latitude
longitude.2011 = y2011.cov$longitude
habitat.2011 = y2011.cov$habitat.orig
latitude.2011 = y2011.cov$latitude

```


#### UnmarkedFrameOccu
Create unmarkedFrameOccu by separating the sitecovariates from the observational covariates
```{r}
# Create the covariates for 'obsCovs', as they need to be in a matrix form
obs.habitat.2011 = matrix(data = rep(habitat.2011, 20), nrow = 479, ncol = 20)
obs.avg.temp.june.2011 = matrix(data = rep(avg.temp.june.2011, 20), nrow = 479, ncol = 20)
obs.masl.2011 = matrix(data = rep(masl.2011, 20), nrow = 479, ncol = 20)

# UnmakredFrameOccu
umf = unmarkedFrameOccu(y = y2011.cov[1:20], siteCovs = data.frame(masl.2011, avg.temp.june.2011, habitat.2011, latitude.2011), obsCovs = list(obs.masl.2011 = obs.masl.2011, obs.avg.temp.june.2011 = obs.avg.temp.june.2011, obs.habitat.2011 = obs.habitat.2011))
```


#### Model selection on the detection part. 
```{r}
# formula = ~ detection ~ occupancy

# Effect of habitat on detection prob
dmod1 = occu(formula = ~ 1 ~ 1, data = umf, knownOcc = row2011)

dmod2 = occu(formula = ~ obs.habitat.2011 ~ 1, data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
fms = fitList("p(.)psi(.)" = dmod1,
              "p(habitat)psi(.)" = dmod2)
(dmodel.sel = modSel(fms))
# NaNs produced! Do not think it worked the way you thought it would.

# Effect of mean june temp on detection prob
dmod3 = occu(formula = ~ obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod4 = occu(formula = ~ obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod5 = occu(formula = ~ obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + I(obs.avg.temp.june.2011^3) ~ 1, data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
dms1 = fitList("p(.)psi(.)" = dmod1,
               "p(temp)psi(.)" = dmod3,
               "p(temp + temp2)psi(.)" = dmod4,
               "p(temp + temp2 + temp3)psi(.)" = dmod5)
(dmodel.sel1 = modSel(dms1))
# Model 4 best, but only with AICdelta of 0.27 to model 3 which has 1 less parameter and is the one I will choose? 

# Effect of mean june temp on detection prob
dmod6 = occu(formula = ~ obs.masl.2011 ~ 1, data = umf, knownOcc = row2011)

dmod7 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod8 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + I(obs.masl.2011^3) ~ 1, data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
dms2 = fitList("p(.)psi(.)" = dmod1,
               "p(elev)psi(.)" = dmod6,
               "p(elev + elev2)psi(.)" = dmod7,
               "p(elev + elev2 + elev3)psi(.)" = dmod8)
(dmodel.sel2 = modSel(dms2))

# Effect of elevation and mean june temp on detection prob
dmod9 = occu(formula = ~ 1 ~ 1, data = umf, knownOcc = row2011) 

dmod10 = occu(formula = ~ obs.masl.2011 ~ 1, data = umf, knownOcc = row2011)

dmod11 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod12 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + I(obs.masl.2011^3) ~ 1, data = umf, knownOcc = row2011)

dmod13 = occu(formula = ~ obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod14 = occu(formula = ~ obs.masl.2011 + obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod15 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod16 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + I(obs.masl.2011^3) + obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod17 = occu(formula = ~ obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod18 = occu(formula = ~ obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + I(obs.avg.temp.june.2011^3) ~ 1, data = umf, knownOcc = row2011)

dmod19 = occu(formula = ~ obs.masl.2011 + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod20 = occu(formula = ~ obs.masl.2011 + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + I(obs.avg.temp.june.2011^3) ~ 1, data = umf, knownOcc = row2011)

dmod21 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod22 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + I(obs.masl.2011^3) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod23 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + I(obs.avg.temp.june.2011^3) ~ 1, data = umf, knownOcc = row2011)

dmod24 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + I(obs.masl.2011^3) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + I(obs.avg.temp.june.2011^3) ~ 1, data = umf, knownOcc = row2011)

dmod25 = occu(formula = ~ obs.masl.2011 + obs.avg.temp.june.2011 + obs.masl.2011:obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod26 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod27 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dmod28 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ 1, data = umf, knownOcc = row2011)


# Insert the fitted models into a "fitList" and rank them by AIC
dms3 = fitList("p(.)psi(.)" = dmod9,
               "p(elev)psi(.)" = dmod10,
               "p(elev + elev2)psi(.)" = dmod11,
               "p(elev + elev2 + elev3)psi(.)" = dmod12,
               "p(temp)psi(.)" = dmod13,
               "p(elev + temp)psi(.)" = dmod14,
               "p(elev + elev2 + temp)psi(.)" = dmod15,
               "p(elev + elev2 + elev3 + temp)psi(.)" = dmod16,
               "p(temp + temp2)psi(.)" = dmod17,
               "p(temp + temp2 + temp3)psi(.)" = dmod18,
               "p(elev + temp + temp2)psi(.)" = dmod19,
               "p(elev + temp + temp2 + temp3)psi(.)" = dmod20,
               "p(elev + elev2 + temp + temp2)psi(.)" = dmod21,
               "p(elev + elev2 + elev3 + temp + temp2)psi(.)" = dmod22,
               "p(elev + elev2 + temp + temp2 + temp3)psi(.)" = dmod23,
               "p(elev + elev2 + elev3 + temp + temp2 + temp3)psi(.)" = dmod24,
               "p(elev + temp + elev:temp)psi(.)" = dmod25,
               "p(elev + elev2 + temp + temp2 + elev:temp)psi(.)" = dmod26,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp)psi(.)" = dmod27,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)" = dmod28)
(dmodel.sel3 = modSel(dms3))

# Effect of latitude on detection probability
dmod29 = occu(formula = ~ latitude.2011 ~ 1, data = umf, knownOcc = row2011)

dmod30 = occu(formula = ~ latitude.2011 + I(latitude.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod31 = occu(formula = ~ latitude.2011 + I(latitude.2011^2) + I(latitude.2011^3) ~ 1, data = umf, knownOcc = row2011)

dms4 = fitList("p(.)psi(.)" = dmod9,
               "p(latitude)psi(.)" = dmod29,
               "p(latitude + latitude2)psi(.)" = dmod30,
               "p(latitude + latitude2 + latitude3)psi(.)" = dmod31)
(dmodel.sel4 = modSel(dms4))

# Effect of elevation, temp and lat
dmod32 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) + latitude.2011 ~ 1, data = umf, knownOcc = row2011)

dmod33 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) + latitude.2011 + I(latitude.2011^2) ~ 1, data = umf, knownOcc = row2011)

dmod34 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) + latitude.2011 + I(latitude.2011^2) + latitude.2011:obs.avg.temp.june.2011 ~ 1, data = umf, knownOcc = row2011)

dms5 = fitList("p(.)psi(.)" = dmod9, 
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)" = dmod28,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2 + latitude)psi(.)" = dmod32,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2 + latitude + latitude2)psi(.)" = dmod33,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2 + latitude + latitude2 + latitude:temp)psi(.)" = dmod34)
(dmodel.sel5 = modSel(dms5))

```

The model with temperature as a covariate of detection probability has substantial support. The model without temp has an AICdelta > 10 and therefore essentially has no support. 

                              nPars    AIC delta  AICwt cumltvWt
p(temp + temp2 + temp3)psi(.)     5 284.82  0.00 0.5247     0.52
p(temp + temp2)psi(.)             4 285.09  0.27 0.4581     0.98
p(temp)psi(.)                     3 291.94  7.12 0.0149     1.00
p(.)psi(.)                        2 295.74 10.92 0.0022     1.00

The model with elevation as a covariate of detection probability has substantial support. The model without elev has an AICdelta = 8.01 and therefore essentially has no support. 

                              nPars    AIC delta AICwt cumltvWt
p(elev + elev2)psi(.)             4 287.73  0.00 0.709     0.71
p(elev + elev2 + elev3)psi(.)     5 289.70  1.97 0.264     0.97
p(elev)psi(.)                     3 295.63  7.90 0.014     0.99
p(.)psi(.)                        2 295.74  8.01 0.013     1.00

The AIC values for model selection with both elevation and temperature showed that dmod28 was the best (p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)). However, this model also has 9 parameters, which might be too much (error message later on).


#### Model selection on the occupancy part

The correlation between 'masl.2011' and 'avg.temp.june.2011' = -0.4461618, and this is quite high, and could therefore affect the results I'm getting?
```{r}
# formula = ~ detection ~ occupancy
# Looking for the effects of elevation first
om1 = occu(formula = ~ 1 ~ 1, data = umf, knownOcc = row2011)

om2 = occu(formula = ~ 1 ~ masl.2011, data = umf, knownOcc = row2011)

om3 = occu(formula = ~ 1 ~ masl.2011 + I(masl.2011^2), data = umf, knownOcc = row2011)

om4 = occu(formula = ~ 1 ~ masl.2011 + I(masl.2011^2) + I(masl.2011^3), data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
oms1 = fitList("p(.)psi(.)" = om1,
              "p(.)psi(elevation)" = om2,
              "p(.)psi(elevation + elevation2)" = om3,
              "p(.)psi(elevation + elevation2 + elevation3)" = om4)
(omodel.sel1 = modSel(oms1))

# Look for the effects of mean june temperature
om5 = occu(formula = ~ 1 ~ avg.temp.june.2011, data = umf, knownOcc = row2011)

om6 = occu(formula = ~ 1 ~ avg.temp.june.2011 + I(avg.temp.june.2011^2), data = umf, knownOcc = row2011)

om7 = occu(formula = ~ 1 ~ avg.temp.june.2011 + I(avg.temp.june.2011^2) + I(avg.temp.june.2011^3), data = umf, knownOcc = row2011) 

# Insert the fitted models into a "fitList" and rank them by AIC
oms2 = fitList("p(.)psi(.)" = om1,
              "p(.)psi(temp)" = om5,
              "p(.)psi(temp + temp2)" = om6,
              "p(.)psi(temp + temp2 + temp3)" = om7)

(omodel.sel2 = modSel(oms2))

# Look for the effects of habitat
om8 = occu(formula = ~ 1 ~ habitat.2011, data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
oms3 = fitList("p(.)psi(.)" = om1,
              "p(.)psi(habitat)" = om8)

(omodel.sel3 = modSel(oms3))

# Look for the effects of elevation when elevation and temp are in the detection prob.
om9 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ masl.2011, data = umf, knownOcc = row2011)

om10 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ masl.2011 + I(masl.2011^2), data = umf, knownOcc = row2011)

om11 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ masl.2011 + I(masl.2011^2) + I(masl.2011^3), data = umf, knownOcc = row2011)

oms4 = fitList("p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)" = dmod28,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev)" = om9,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev + elev2)" = om10,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev + elev2 + elev3)" = om11)
(omodel.sel4 = modSel(oms4))

# Look for the effects of temperature when elevation and temp are in the detection prob.
om12 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ avg.temp.june.2011, data = umf, knownOcc = row2011)

om13 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ avg.temp.june.2011 + I(avg.temp.june.2011^2), data = umf, knownOcc = row2011)

om14 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ avg.temp.june.2011 + I(avg.temp.june.2011^2) + I(avg.temp.june.2011^3), data = umf, knownOcc = row2011)

oms5 = fitList("p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)" = dmod28,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp)" = om12,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp + temp2)" = om13,
               "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp + temp2 + temp3)" = om14)
(omodel.sel5 = modSel(oms5))

# Look for the effects of habitat when elevation and temp are in the detection prob.
om15 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ habitat.2011, data = umf, knownOcc = row2011)

# Insert the fitted models into a "fitList" and rank them by AIC
oms6 = fitList("p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)" = dmod28,
              "p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(habitat)" = om15)

(omodel.sel6 = modSel(oms6))

# Pick the best elevation occupancy model and then look for the effects of temperature and habitat
#om16 = occu(formula = ~ obs.masl.2011 + I(obs.masl.2011^2) + obs.avg.temp.june.2011 + I(obs.avg.temp.june.2011^2) + obs.masl.2011:obs.avg.temp.june.2011 + I(obs.masl.2011^2):obs.avg.temp.june.2011 + obs.masl.2011:I(obs.avg.temp.june.2011^2) ~ obs.masl.2011 + I(obs.masl.2011^2), data = umf, knownOcc = row2011)
# "ERROR: Hessian is singular. Try providing starting values or using fewer covariates."

```

Model selection tables. Looking for effects of the covariates elevation, temperature and habitat. An AICdelta < 2 between models is generally considered to have a substantial level of empirical support. 

Model selection for the effects of elevation on occupancy (constant detection probability): For the elevation example, the first two models have elevation included and adding the weights of these two gives a cumulative weight of 0.77 and this gives substantial support to the elevation hypothesis.

                                             nPars  AIC   delta   AICwt   cumltvWt
p(.)psi(elevation + elevation2)                  4 293.85  0.00   0.428     0.43
p(.)psi(elevation + elevation2 + elevation3)     5 294.31  0.45   0.342     0.77
p(.)psi(.)                                       2 295.74  1.89   0.167     0.94
p(.)psi(elevation)                               3 297.68  3.83   0.063     1.00


Model selection for the effects of mean june temperature on occupancy (constant detection probability): Here, the model without temperature essentially have no support (AICdelta > 10).The first two models show an AICdelta < 2, and I therefore want to choose the second model as there are fewer parameters in this model, but there might be biological reasons for the first model that I cannot see at the moment?

                                             nPars  AIC   delta   AICwt     cumltvWt
p(.)psi(temp + temp2 + temp3)                    5 278.18  0.00   0.64         0.64
p(.)psi(temp)                                    3 279.96  1.78   0.26         0.90
p(.)psi(temp + temp2)                            4 281.87  3.68   0.1          1.00
p(.)psi(.)                                       2 295.74 17.56   0.000098     1.00


Model selection for the effects of habitat on occupancy (constant detection probability): Here, habitat is included in the model just as they are noted in the dataset, as a factor with 5 levels (Annet, fjellveg., skogveg., bre, myr). I am currently unsure if I should do anything to this covariate (0,0,0,0,0 ; 1,0,0,0,0 ; ... ; 1,1,1,1,0) or keep as is. The AIC shows substantial support for habitat to be included into the final model.

                 nPars    AIC delta AICwt cumltvWt
p(.)psi(habitat)     6 290.58  0.00  0.93     0.93
p(.)psi(.)           2 295.74  5.16  0.07     1.00


Model selection for the effects of elevation on occupancy (detection prob = elev+elev2+temp+temp2+elev:temp+elev2:temp+elev:temp2): Here, the AIC values show that the models with elevation included have substantial support. 

                                                                                              nPars    AIC delta AICwt cumltvWt
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev + elev2)            11 258.81  0.00 0.474     0.47
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev)                    10 259.73  0.92 0.299     0.77
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(elev + elev2 + elev3)    12 260.73  1.92 0.181     0.95
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)                        9 263.47  4.66 0.046     1.00


Model selection for the effects of mean june temperature on occupancy: Here, the AIC values show that the model with temperature included do have substantial support.

                                                                                              nPars    AIC delta AICwt cumltvWt
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp + temp2)            11 260.09  0.00 0.382     0.38
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp)                    10 260.55  0.46 0.304     0.69
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(temp + temp2 + temp3)    12 261.00  0.90 0.243     0.93
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)                        9 263.47  3.38 0.071     1.00


Model selection for the effects of habitat on occupancy (detection prob = elev+elev2+temp+temp2): Difficult to say if habitat should be included as the AICdelta is just over 2. 
                                                                                 nPars    AIC delta AICwt cumltvWt
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(.)           9 263.47  0.00  0.79     0.79
p(elev + elev2 + temp + temp2 + elev:temp + elev2:temp + elev:temp2)psi(habitat)    13 266.11  2.64  0.21     1.00




Identifying the rows for the known occupancy of the 2012 detection/nondetection data
```{r}
line2012 = c()

# for loop that appends the rows from the line observations with the year 2012 to the variable line2012
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2012) {
    line2012 = append(line2012, lineobs[row, 1])
  }
}
line2012 = matrix(line2012, ncol = 1)
line2012 = cbind(line2012, rep(2012, length(line2012)))
line2012 = cbind(line2012, rep(1, length(line2012[,1]))) # Adding 1 to all the entries of line 2012
line2012 = matrix(line2012, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2012 = data.frame(line2012)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2012 = line2012$sitenumber
count = 0
row2012 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2012)){
    row2012 = append(row2012, count)
  }
}
```

Identifying the rows for the known occupancy of the 2013 detection/nondetection data
```{r}
line2013 = c()

# for loop that appends the rows from the line observations with the year 2013 to the variable line2013
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2013) {
    line2013 = append(line2013, lineobs[row, 1])
  }
}
line2013 = matrix(line2013, ncol = 1)
line2013 = cbind(line2013, rep(2013, length(line2013)))
line2013 = cbind(line2013, rep(1, length(line2013[,1]))) # Adding 1 to all the entries of line 2013
line2013 = matrix(line2013, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2013 = data.frame(line2013)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2013 = line2013$sitenumber
count = 0
row2013 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2013)){
    row2013 = append(row2013, count)
  }
}
```

Identifying the rows for the known occupancy of the 2014 detection/nondetection data
```{r}
line2014 = c()

# for loop that appends the rows from the line observations with the year 2014 to the variable line2014
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2014) {
    line2014 = append(line2014, lineobs[row, 1])
  }
}
line2014 = matrix(line2014, ncol = 1)
line2014 = cbind(line2014, rep(2014, length(line2014)))
line2014 = cbind(line2014, rep(1, length(line2014[,1]))) # Adding 1 to all the entries of line 2014
line2014 = matrix(line2014, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2014 = data.frame(line2014)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2014 = line2014$sitenumber
count = 0
row2014 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2014)){
    row2014 = append(row2014, count)
  }
}
```

Identifying the rows for the known occupancy of the 2015 detection/nondetection data
```{r}
line2015 = c()

# for loop that appends the rows from the line observations with the year 2015 to the variable line2015
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2015) {
    line2015 = append(line2015, lineobs[row, 1])
  }
}
line2015 = matrix(line2015, ncol = 1)
line2015 = cbind(line2015, rep(2015, length(line2015)))
line2015 = cbind(line2015, rep(1, length(line2015[,1]))) # Adding 1 to all the entries of line 2015
line2015 = matrix(line2015, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2015 = data.frame(line2015)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2015 = line2015$sitenumber
count = 0
row2015 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2015)){
    row2015 = append(row2015, count)
  }
}
```

Identifying the rows for the known occupancy of the 2016 detection/nondetection data
```{r}
line2016 = c()

# for loop that appends the rows from the line observations with the year 2016 to the variable line2016
for (row in 1:nrow(lineobs)) {
  sitenumber = lineobs[row, "RuteID"]
  year  = lineobs[row, "Aar"]
  
  if(year == 2016) {
    line2016 = append(line2016, lineobs[row, 1])
  }
}
line2016 = matrix(line2016, ncol = 1)
line2016 = cbind(line2016, rep(2016, length(line2016)))
line2016 = cbind(line2016, rep(1, length(line2016[,1]))) # Adding 1 to all the entries of line 2016
line2016 = matrix(line2016, ncol = 3, dimnames = list(c(), c("sitenumber", "year", "number")))
line2016 = data.frame(line2016)

# A for loop to identify the rows needed for the knownOccu argument in the Occu function of unmarked
sitenum2016 = line2016$sitenumber
count = 0
row2016 = c()
for(i in sitenum){
  count = count + 1
  if(any(i == sitenum2016)){
    row2016 = append(row2016, count)
  }
}
```












